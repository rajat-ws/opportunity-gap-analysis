<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webhook API Tester</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .url-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #007bff;
            margin-bottom: 30px;
            font-family: monospace;
            word-break: break-all;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #555;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background-color 0.3s;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .run-all {
            background: #28a745;
        }
        .run-all:hover {
            background: #1e7e34;
        }
        textarea {
            width: 100%;
            height: 120px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            resize: vertical;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }
        .result-item {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #ddd;
        }
        .result-success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .result-error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .result-warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        .status-code {
            font-weight: bold;
            font-size: 18px;
        }
        .timestamp {
            color: #666;
            font-size: 12px;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .method-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }
        .method-get { background: #17a2b8; color: white; }
        .method-post { background: #28a745; color: white; }
        .method-put { background: #ffc107; color: black; }
        .method-delete { background: #dc3545; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîó Webhook API Tester</h1>
        
        <div class="url-display">
            <strong>Endpoint:</strong> https://primary-production-3fc7a.up.railway.app/webhook/opportunity-gap-trigger
        </div>

        <div class="test-section">
            <h3>üöÄ Quick Actions</h3>
            <button onclick="runQuickTest()" id="quickBtn">Quick POST Test</button>
            <button onclick="runAllTests()" id="allBtn" class="run-all">Run All Tests</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>

        <div class="test-section">
            <h3>üì° Individual Tests</h3>
            <button onclick="testMethod('GET')" id="getBtn">Test GET</button>
            <button onclick="testMethod('POST')" id="postBtn">Test POST</button>
            <button onclick="testMethod('PUT')" id="putBtn">Test PUT</button>
            <button onclick="testMethod('DELETE')" id="deleteBtn">Test DELETE</button>
        </div>

        <div class="test-section">
            <h3>üìù Custom Payload (for POST/PUT)</h3>
            <textarea id="customPayload" placeholder='Enter custom JSON payload here, e.g.:
{
  "event": "custom-test",
  "data": {
    "message": "Custom test message",
    "userId": 123
  }
}'></textarea>
            <button onclick="testWithCustomPayload('POST')">Send Custom POST</button>
            <button onclick="testWithCustomPayload('PUT')">Send Custom PUT</button>
        </div>

        <div class="results" id="results">
            <h3>üìä Test Results</h3>
            <div id="resultsList">
                <p style="color: #666; font-style: italic;">No tests run yet. Click a test button above to start.</p>
            </div>
        </div>
    </div>

    <script>
        const WEBHOOK_URL = "https://primary-production-3fc7a.up.railway.app/webhook/opportunity-gap-trigger";
        let testResults = [];

        function addLoading(buttonId) {
            const btn = document.getElementById(buttonId);
            if (btn && !btn.innerHTML.includes('loading')) {
                btn.innerHTML += ' <span class="loading"></span>';
                btn.disabled = true;
            }
        }

        function removeLoading(buttonId) {
            const btn = document.getElementById(buttonId);
            if (btn) {
                btn.innerHTML = btn.innerHTML.replace(/ <span class="loading"><\/span>/, '');
                btn.disabled = false;
            }
        }

        async function makeRequest(method, payload = null) {
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                    'User-Agent': 'WebhookTester/1.0'
                }
            };

            if (payload && (method === 'POST' || method === 'PUT')) {
                options.body = JSON.stringify(payload);
            }

            try {
                const response = await fetch(WEBHOOK_URL, options);
                let data = null;

                try {
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        data = await response.json();
                    } else {
                        data = await response.text();
                    }
                } catch (e) {
                    data = null;
                }

                return {
                    method,
                    status: response.status,
                    statusText: response.statusText,
                    data,
                    timestamp: new Date().toISOString(),
                    success: response.ok
                };
            } catch (error) {
                return {
                    method,
                    status: 0,
                    statusText: 'Network Error',
                    error: error.message,
                    timestamp: new Date().toISOString(),
                    success: false
                };
            }
        }

        async function testMethod(method) {
            const buttonMap = {
                'GET': 'getBtn',
                'POST': 'postBtn',
                'PUT': 'putBtn',
                'DELETE': 'deleteBtn'
            };

            addLoading(buttonMap[method]);

            let payload = null;
            if (method === 'POST' || method === 'PUT') {
                payload = {
                    event: method === 'POST' ? 'opportunity-gap-trigger' : 'opportunity-gap-update',
                    timestamp: new Date().toISOString(),
                    data: {
                        message: `Test ${method} request`,
                        testId: Math.random().toString(36).substr(2, 9)
                    }
                };
            }

            const result = await makeRequest(method, payload);
            testResults.push(result);
            displayResults();
            removeLoading(buttonMap[method]);

            console.log(`${method} test result:`, result);
        }

        async function testWithCustomPayload(method) {
            const payloadText = document.getElementById('customPayload').value.trim();
            
            if (!payloadText) {
                alert('Please enter a custom payload');
                return;
            }

            let payload;
            try {
                payload = JSON.parse(payloadText);
            } catch (e) {
                alert('Invalid JSON payload: ' + e.message);
                return;
            }

            const buttonId = method === 'POST' ? 'postBtn' : 'putBtn';
            addLoading(buttonId);

            const result = await makeRequest(method, payload);
            testResults.push(result);
            displayResults();
            removeLoading(buttonId);

            console.log(`Custom ${method} test result:`, result);
        }

        async function runQuickTest() {
            addLoading('quickBtn');
            
            const payload = {
                test: true,
                message: "Quick test from webhook tester",
                timestamp: new Date().toISOString()
            };

            const result = await makeRequest('POST', payload);
            testResults.push(result);
            displayResults();
            removeLoading('quickBtn');

            console.log('Quick test result:', result);
        }

        async function runAllTests() {
            addLoading('allBtn');
            
            console.log('üöÄ Running all webhook tests...');
            
            // Run tests sequentially to avoid overwhelming the server
            await testMethod('GET');
            await new Promise(resolve => setTimeout(resolve, 500)); // Small delay
            
            await testMethod('POST');
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testMethod('PUT');
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testMethod('DELETE');
            
            removeLoading('allBtn');
            console.log('‚úÖ All tests completed');
        }

        function clearResults() {
            testResults = [];
            displayResults();
        }

        function displayResults() {
            const resultsList = document.getElementById('resultsList');
            
            if (testResults.length === 0) {
                resultsList.innerHTML = '<p style="color: #666; font-style: italic;">No tests run yet. Click a test button above to start.</p>';
                return;
            }

            const resultsHtml = testResults.map(result => {
                const successClass = result.success ? 'result-success' : 
                                   result.status >= 400 ? 'result-error' : 'result-warning';
                
                const methodClass = `method-${result.method.toLowerCase()}`;
                
                return `
                    <div class="result-item ${successClass}">
                        <div>
                            <span class="method-tag ${methodClass}">${result.method}</span>
                            <span class="status-code">Status: ${result.status} ${result.statusText}</span>
                            <span class="timestamp">${new Date(result.timestamp).toLocaleString()}</span>
                        </div>
                        ${result.data ? `<div style="margin-top: 10px;"><strong>Response:</strong><br><pre style="margin: 5px 0; white-space: pre-wrap; font-size: 12px;">${JSON.stringify(result.data, null, 2)}</pre></div>` : ''}
                        ${result.error ? `<div style="margin-top: 10px; color: #dc3545;"><strong>Error:</strong> ${result.error}</div>` : ''}
                    </div>
                `;
            }).join('');

            resultsList.innerHTML = resultsHtml;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîß Webhook tester loaded!');
            console.log('Endpoint:', WEBHOOK_URL);
            
            // Set default custom payload
            document.getElementById('customPayload').value = `{
  "event": "custom-test",
  "timestamp": "${new Date().toISOString()}",
  "data": {
    "message": "Custom test message",
    "testId": "${Math.random().toString(36).substr(2, 9)}"
  }
}`;
        });
    </script>
</body>
</html> 